<!DOCTYPE html>
<html>
  <head>
    <!-- meta -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" type="text/css" href="/css/common.css">

<title>OpenSSHの導入 | Perl環境構築 - Linux入門 - Perlゼミ基礎講座</title>
<meta name="description" content="(CentOS5.7で確認)">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <!-- header -->
<h1>
  <a href="/">Linux入門 - Perlゼミ基礎講座</a>
</h1>

      </div>
      <div class="main">
        <div class="content">
          <div class="entry">
  <div class="top">
    <!-- top -->

  </div>
  <div class="middle">
    <h2><a href="/blog/20190128171737.html">OpenSSHの導入 | Perl環境構築</a></h2>
<p>
  (CentOS5.7で確認)
</p>
<h3>OpenSSHサーバの導入</h3>
<p>
  　SSHは安全なリモートログインを実現するサービスで、telnetのセキュリティ強化バージョンにあたります。SSHを利用すると通信に利用されるデータを暗号化することができます。SSHのためのサーバとして、OpenSSHというものがあります。
</p>
<p>
  　以下の３つのパッケージが必要になります。
</p>
<p>
  -openssh ( SSH接続のためのクライアントソフト )
</p>
<p>
  -openssh-server ( SSH接続を受け付けるサーバ )
</p>
<p>
  -openssl ( SSHの暗号化部分の実装であるSSLのためのソフトウェア )
</p>
<h3>インストール</h3>
<p>
  　以下のコマンドでインストールできます。
</p>
<pre>
yum -y install openssh
yum -y install openssh-server
yum -y install openssl
</pre>
<h3>インストールの確認</h3>
<p>
  　rpmコマンドで上記３つのパッケージが含まれているかを確認します。
</p>
<pre>
rpm -q openssh
rpm -q openssh-server
rpm -q openssl
</pre>
<h3>サービス起動スクリプト</h3>
<p>
  　サービス起動スクリプトを見ればいろいろな情報がわかります。
</p>
<pre>
&lt;h3&gt; サービス起動スクリプトを見る。&lt;/h3&gt;
view /etc/init.d/sshd
</pre>
<h3>サービスの自動起動の設定</h3>
<p>
  　自動起動の設定を確認する。
</p>
<pre>
&lt;h3&gt; 自動起動の確認&lt;/h3&gt;
chkconfig --list sshd

&lt;h3&gt; ランレベル2345がonになっていない場合はonにする。(サービス起動スクリプトに推奨されるランレベルの記述がある。)&lt;/h3&gt;
chkconfig --level 2345 sshd on

&lt;h3&gt; サービスそのものとして登録されていない場合は追加する。&lt;/h3&gt;
chkconfig --add sshd
</pre>
<h3>サービスの開始・停止・確認</h3>
<pre>
&lt;h3&gt; サービスが開始しているかどうかの確認&lt;/h3&gt;
service sshd status

&lt;h3&gt; 開始していない場合は開始&lt;/h3&gt;
service sshd start

&lt;h3&gt; 停止する場合は&lt;/h3&gt;
service sshd stop
</pre>
<h3>設定ファイル</h3>
<h4>sshdの設定ファイル</h4>
<pre>
/etc/ssh/sshd_config
</pre>
<h3>設定ファイルでのセキュリティ上の考慮</h3>
<h4>SSHのバージョンには2のみを使用する。</h4>
<p>
  　以下のようになっていることを確認。SSH1 にはセキュリティホールがあり、SSH2のみを使うようにする。
</p>
<pre>
Protocol 2
</pre>
<h4>rootでの直接的なログインを禁止する</h4>
<p>
  　rootで直接ログインできた場合、複数の管理者がいると、誰がrootで操作したのかが把握できなくなるのでrootログインを禁止します。
</p>
<pre>
PermitRootLogin no
</pre>
<h4>sshdのセキュリティに関するログ</h4>
<p>
  　デフォルトだと
</p>
<pre>
/var/log/secure
</pre>
<p>
  に出力されるようです。
</p>
<h3>アクセス制御設定ファイルの編集</h3>
<p>
  　特定のIPアドレスだけからのアクセスを許可するようにします。
</p>
<h4>/etc/hosts.deny</h4>
<p>
  　まずsshdへのアクセスをすべて拒否する。
</p>
<pre>
sshd: ALL
</pre>
<h4>/etc/hosts.allow</h4>
<p>
  　必要なものだけアクセスを許可する(必要に応じて設定)。
</p>
<pre>
&lt;h3&gt; (例)192.168.1.0 ～ 192.168.1.255 までを許可&lt;/h3&gt;
sshd: 192.168.1.
</pre>
<h3>公開鍵の作成</h3>
<p>
  　公開鍵はサーバ側ではなく、クライアント側で作成して、サーバ側に移動させます。クライアント側での鍵の作成も別途必要になります。
</p>
<h3>ログインユーザのホームディレクトリに公開鍵を設置</h3>
<p>
  　クライアント側での公開鍵の作成作業が終われば、再びサーバ側での作業です。まず、自分のIDでサーバにログインします。
</p>
<p>
  　まず、.sshというディレクトリをユーザのホームディレクトリに作成します。( ~ はユーザのホームディレクトリを指します)
</p>
<pre>
mkdir ~/.ssh
</pre>
<p>
  　確認するには
</p>
<pre>
ls -a
</pre>
<p>
  とします。(.で始まるファイルは ls では見れないため )
</p>
<p>
  ここに、アップロードした公開鍵を移動しておきます。(公開鍵はホームディレクトリにアップロードしていると想定します。)
</p>
<pre>
mv ~/id_dsa.pub ~/.ssh
</pre>
<p>
  　その後ログインユーザのホームディレクトリの .ssh/authorized_keys というファイルに、アップロードした公開鍵を追加書き込みします。
</p>
<pre>
&lt;h3&gt; authorized_keysファイルの作成&lt;/h3&gt;
touch ~/.ssh/authorized_keys

&lt;h3&gt; authorized_keysファイルに追加書き込み&lt;/h3&gt;
cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys

&lt;h3&gt; .sshディレクトリとauthorized_keysの書き込み権限はユーザだけにしておく&lt;/h3&gt;
&lt;h3&gt; (こうしないとセキュリティ上の理由で接続できない)&lt;/h3&gt;
chmod 755 ~/.ssh
chmod 644 ~/.ssh/authorized_keys

&lt;h3&gt;確認( 所有者はログインユーザで、パーミッションが上記のとおりになっていることを確認)&lt;/h3&gt;
&lt;h3&gt; .sshディレクトリの確認( drwxr-xr-x )&lt;/h3&gt;
ls -al ~/

&lt;h3&gt; authorized_keysの確認( -rw-r--r-- )&lt;/h3&gt;
ls -al ~/.ssh/authorized_keys
</pre>
<h3>sshd_configの設定変更</h3>
<p>
  　設定ファイルは
</p>
<pre>
/etc/ssh/sshd_config
</pre>
<p>
  です。
</p>
<p>
  　おそらく、以下の行がコメントアウトされているので # を消します。
</p>
<p>
  　公開鍵認証できるようにする設定と、公開鍵情報のファイルの設定です。
</p>
<pre>
&lt;h3&gt;PubkeyAuthentication yes&lt;/h3&gt;
&lt;h3&gt;AuthorizedKeysFile     .ssh/authorized_keys&lt;/h3&gt;
</pre>
<p>
  ↓
</p>
<pre>
PubkeyAuthentication yes
AuthorizedKeysFile     .ssh/authorized_keys
</pre>
<p>
  　公開鍵認証ができるようになったので、パスワード認証ができないようにしておきます。
</p>
<pre>
PasswordAuthentication yes
</pre>
<p>
  ↓
</p>
<pre>
PasswordAuthentication no
</pre>
<p>
  　設定を反映されるためsshdを再起動
</p>
<pre>
service sshd restart
</pre>
<h3>クライアント側からの接続</h3>
<p>
  　ここまでの作業を終えればクライアント側からSSH接続ができます。
</p>

  </div>
  <div class="bottom">
    <!-- bottom -->

  </div>
</div>

        </div>
        <div class="side">
          <!-- side -->
<div class="side-list">
  <div class="side-list-title">
    目次
  </div>
  <ul>
    <li><a href="/list.html">記事一覧</a></li>
  </ul>
</div>

        </div>
      </div>
      <div class="footer">
        <!-- footer -->
<a href="https://tutorial.perlzemi.com">Perlゼミ</a> & <a href="https://jp.giblog.net/">Giblog</a>

      </div>
    </div>
  </body>
</html>
