<!DOCTYPE html>
<html>
  <head>
    <!-- meta -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" type="text/css" href="/css/common.css">

<title>WebアプリのためのCentOS環境構築 - Linuxサーバー入門 - Perlゼミ基礎講座</title>
<meta name="description" content="環境構築というのはとても範囲が広く、一筋縄ではいきません。小さなシステムであれば、Perlのプログラマが、環境構築の多くの部分にかかわるというのは、きっとよくあることでしょう。周辺知識についてある程度知っていれば、お仕事の幅の広がるかもしれません。">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <!-- header -->
<h1>
  <a href="/">Linuxサーバー管理入門 - PerlゼミのLinux講座</a>
</h1>

      </div>
      <div class="main">
        <div class="content">
          <div class="entry">
  <div class="top">
    <!-- top -->

  </div>
  <div class="middle">
    <h2><a href="/blog/20190311171737.html">WebアプリのためのCentOS環境構築</a></h2>
<p>
  　環境構築というのはとても範囲が広く、一筋縄ではいきません。小さなシステムであれば、Perlのプログラマが、環境構築の多くの部分にかかわるというのは、きっとよくあることでしょう。周辺知識についてある程度知っていれば、お仕事の幅の広がるかもしれません。 
</p>
<p>
  　最低限知っておけば、Webアプリケーションをその上に構築できる環境を整えることができる知識について書いてみます。結構覚えることが多いんので、環境構築も一筋縄ではいかないことがわかります。　　
</p>
<h3>アプリケーションのインストール</h3>
<p>
  　最初に覚えるのはyumコマンドです。インターネット上から、rpmパッケージと呼ばれるアプリケーションのパッケージをインストールしするためのモジュールです。
</p>
<pre>
yum install パッケージ名
</pre>
<h3>データベース</h3>
<p>
  　アプリケーションのデータを保存するためにデータベースを利用します。仕事でアプリケーションを作成する場合は、データをファイルに保存することはなく、必ずといってよいほどデータベースを利用することになります。
</p>
<p>
  　データベースの利点はたくさんありますが、いくつかのポイントを挙げておきます。大量のデータに対して処理が高速である、SQLという汎用言語を利用してデータの取得ができる、排他処理を行うことができる、トランザクションが利用できる、バックアップユーティリティが豊富などがあげられます。
</p>
<p>
  　Perlでデータベースを利用するのであればMySQLを利用するのがもっとも一般的な選択肢になるのではないかと思います。MySQLのインストール方法については、こちらで解説しています。
</p>
<pre>
cpanm DBD::MySQL
</pre>
<p>
  　とするだけです。
</p>
<h3>時刻同期</h3>
<p>
  　サーバーの時刻がずれていくというのは大きな問題になります。たとえば、二つのサーバーの間で時刻がずれていたとしたら、それぞれで出力されるログを正しく並べて、状況を確認することは難しくなってしまうでしょう。またアプリケーションに正しい時刻の情報を提供できなくなってしまうでしょう。
</p>
<p>
  　この問題を解決するにはNTPサーバー(時刻同期サーバー)を利用します。NTPサーバーはサーバーの時刻を自動的に調整するためのものです。時刻のずれを正しい時刻に調節してくれます。
</p>
<h3>ログ出力</h3>
<p>
  　Webアプリケーションで何かの作業を行った場合に、その情報を記録しておきたい場合があります。
</p>
<h4>ログの出力</h4>
<p>
  　ログの出力を行うには自前でログ出力機能を実装するよりも、syslogdにログ出力を担当してもらうほうが簡単でしょう。syslogdはバックグラウンドで実行されるデーモンであり、CentOSのデフォルトで起動される設定になっています。
</p>
<p>
  　syslogdに対してメッセージを送るにはSys::Syslogモジュールを利用するのがよいでしょう。
</p>
<p>
  　またWebアプリケーションフレームワークがログ出力機構を実装しているなら、それを利用するのもよいでしょう。
</p>
<h4>ログのローテーション</h4>
<p>
  　ログの出力が続くと、ディスク容量を圧迫するようになってきます。このために何らかの方法で、ログの容量を管理する必要がでてきます。解決方法として、ログの容量が大きくなってきたり、ある期間が過ぎた場合に、ログをローテーションさせるという方法があります。
</p>
<pre>
messages.log
messages.log.1
messages.log.2
messages.log.3
</pre>
<p>
  　そして、ある番号より古くなったログに対しては削除を行うことで、ログの容量に制限を設けることができるようになります。
</p>
<p>
  　このようなユーティリティとしてlogrotateがあります。これはCentOSにデフォルトでインストールされます。
</p>
<h3>バージョン管理システム</h3>
<p>
  　開発を行うということは、ソースコードの管理やバックアップをとっておくということも大切な作業のひとつになってきます。バージョン管理システムとしてGitを選択するのが現在では最善の選択肢です。Gitを利用すれば、それぞれが部分的に開発を行って、変更を取り込む会うことも簡単にできますし、複数の人が完全なソースコードの履歴を持っているので、バックアップとしての機能もよく果たします。またGitのコマンドは、操作が楽なように作られているので、使い方に慣れてしまえば快適に利用できます。
</p>
<p>
  　Gitはrpmパッケージとしてはデフォルトでは存在しないので、ソースコードからコンパイルしてインストールするのが簡単です。
</p>
<h3>SSHによるリモート接続</h3>
<p>
  　SSHというのはリモートのサーバーに対してコマンドをセキュアに実行するためのプロトコルのことです。SSHの実装としてCentOSではOpenSSHというものを利用します。CentOS上で開発を行う場合は、SSHによる接続によって、サーバーに対するほぼすべての操作を行うことになります。実機で作業をするのはこのOpenSSHの設定を終えるまでです。最初にOpenSSHの設定が終わった後は、Teratermなどのアプリケーションを利用して、リモートから作業をすることになります。
</p>
<h3>Webサーバー</h3>
<p>
  　PerlでWebアプリケーション開発を行うのに必要となるのはWebサーバーです。多くの場合はWebサーバーの80番ポートで受け付けた接続を何らかの形でWebアプリケーションに渡すことになります。プロキシを利用してWebアプリケーションに接続したり、mod_perlやfcgi、PSGIいった形になるでしょう。WebサーバーとしてApacheが有名なです。信頼性やドキュメントの豊富さ、実績という面で最初はApacheを選ぶのがよいでしょう。高速で小さなWebサーバーもありますが、まだドキュメントがあるとはいえないので。
</p>
<p>
  　Apacheのインストール方法は簡単です。
</p>
<pre>
yum -y install httpd
</pre>
<p>
  　ついでに、自動起動の設定も行います。
</p>
<pre>
chkconfig --level 2345 httpd on
</pre>
<p>
  　設定ファイルは
</p>
<pre>
/etc/httpd/conf
</pre>
<p>
  になります。特別な設定はそれほど行う必要はないでしょう。
</p>
<p>
  　またconf.dというディレクトリが存在しますが、このディレクトリの中に追加の設定を記述したファイルを置くことができます。たとえばバーチャルホストを利用して、プロキシサーバー経由でWebアプリケーションを実行したい場合は
</p>
<pre>
virtual_host.conf
</pre>
<h3>SeLinux</h3>
<p>
  　CentOSの最初の壁はSeLinuxです。SeLinuxはセキュリティを強化するためにデフォルトで有効になっているのですが、どの範囲で影響を及ぼしているのかを把握するのが困難なため、泥沼にはまる可能性があります。初期的な環境構築を行う場合は、無効にして設定を進めるほうが、やりやすいでしょう。
</p>
<p>
  　以下が設定ファイルになります。
</p>
<pre>
/etc/selinux
</pre>
<p>
  　以下が無効にする設定です。CentOSの再起動を行う必要があります。
</p>
<pre>
SELINUX=disabled
</pre>
<h3>ファイアーウォール</h3>
<p>
  　ファイアーウォールは難関中の難関です。CentOSではiptablesというアプリケーションがファイアウォールを設定するためのアプリケーションになります。設定が複雑なので覚悟して取り組む必要があります。何かが動かないという原因の第一位と第二位くらいがSeLinuxとiptablesによるファイアーウォールなので、何か動かないものがあれば、環境構築中であれば、いったんファイアーウォールを停止させて動くかを確認しましょう。
</p>
<h3>ネットワークの設定</h3>
<p>
  　ネットワークの設定には、IPアドレス、サブネットマスク、デフォルトゲートウェイ、DNSサーバーの知識をもっておく必要があります。
</p>
<h3>ユーザー管理</h3>
<p>
  　ユーザーを追加したり、削除したりするコマンドを一通り覚えておく必要があります。
</p>
<pre>
useradd ユーザー名
passwd ユーザー名
</pre>
<h3>プログラムの自動実行</h3>
<p>
  　サーバーを管理していると定期的に何かを行いたいという場合が発生することでしょう。cronを利用すれば、ある時刻や、ある時間間隔で、プログラムを実行することができます。
</p>
<h3>メールサーバー</h3>
<p>
  　アプリケーションの中からメールを送信したりするためには、メールサーバーの知識が必要になってきます。単に送信するだけであっても、CentOSでメール送信を行うには、自分のメールサーバー(SMTPサーバー)を経由して、送信するという形になるので、送信するだけであってもメールサーバーを構築する必要があります。
</p>
<p>
  　メールサーバーとしては、sendmailとインターフェースに互換があり、設定ファイルがとても記述しやすいPostfixを選択するのが良い選択肢でしょう。デフォルトのsendmailはとめて、alternativesコマンドで、sendmailコマンドをPostfixのものに切り替え、設定ファイルを適切に記述する必要があります。
</p>

  </div>
  <div class="bottom">
    <!-- bottom -->

  </div>
</div>

        </div>
        <div class="side">
          <!-- side -->
<div class="side-list">
  <div class="side-list-title">
    目次
  </div>
  <ul>
    <li><a href="/list.html">記事一覧</a></li>
  </ul>
</div>

        </div>
      </div>
      <div class="footer">
        <!-- footer -->
<a href="https://tutorial.perlzemi.com">Perlゼミ</a> & <a href="https://jp.giblog.net/">Giblog</a>

      </div>
    </div>
  </body>
</html>
