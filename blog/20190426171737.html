<!DOCTYPE html>
<html>
  <head>
    <!-- meta -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" type="text/css" href="/css/common.css">

<title>【Perl】【Mojolicious】Webアプリを「デバッガ」で簡単にデバッグする方法 - Linuxサーバー管理入門 - Linux講座ならPerlゼミ</title>
<meta name="description" content="!WIN_20170119_23_30_43_Pro.jpg">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <!-- header -->
<h1>
  <a href="/">Linuxサーバー管理入門 - PerlゼミのLinux講座</a>
</h1>

      </div>
      <div class="main">
        <div class="content">
          <div class="entry">
  <div class="top">
    <!-- top -->

  </div>
  <div class="middle">
    <h2><a href="/blog/20190426171737.html">【Perl】【Mojolicious】Webアプリを「デバッガ」で簡単にデバッグする方法</a></h2>
<p>
  !<a href="https://qiita-image-store.s3.amazonaws.com/0/155418/54e08b7e-610c-7b77-fdc1-be2f0a076b62.jpeg">WIN_20170119_23_30_43_Pro.jpg</a>
</p>
<p>
  Webアプリって目で見て確認するだけ? でも、本当に困ったときは、大事な部分は、プログラムの内部の動きも見てみたい。そんなときありますよね。
</p>
<h3> Mojoliciousのデバッグ</h3>
<p>
  <strong>Mojolicious</strong>ではスクリプトを簡単に<strong>デバッグ</strong>することができます。とても短い記述で試験をかけるというのがうれしいですね。
</p>
<p>
  まずはMojolicious::Liteで作成した簡単なWebアプリです。
</p>
<pre>
use Mojolicious::Lite;

get '/' =&gt; sub {
  my $self = shift;

  $DB::single = 1;    

  $self-&gt;render(text =&gt; 'Hello');
};

app-&gt;start;
</pre>
<p>
  このファイルを「myapp.pl」という名前で保存してください。注目するポイントは<b>「$DB::single = 1」</b>という記述です。これはスクリプトの中にブレークポイントを埋め込むための記法です。デバッガはこの行を見つけるとその位置でストップします。
</p>
<p>
  次に試験用のディレクトリを作成します。
</p>
<pre>
mkdir t
</pre>
<p>
  tというディレクトリの中に試験用のスクリプトを配置します。このディレクトリの中に「basic.t」という名前のスクリプトを作成してみてください。
</p>
<h3> URLにHTTPアクセスするためのプログラム</h3>
<p>
  では、試験スクリプトを書いてみましょう。
</p>
<pre>
use Test::More 'no_plan';

use strict;
use warnings;
use utf8;

use Test::Mojo;

use FindBin;
$ENV{MOJO_HOME} = "$FindBin::Bin/..";
require "$ENV{MOJO_HOME}/myapp.pl";

my $t = Test::Mojo-&gt;new;
$t-&gt;get_ok('/');
</pre>
<p>
  このスクリプトはMojolicious::LiteのPODに記述されている自動試験用のスクリプトですが、デバッグを行うためにも利用することができます。
</p>
<p>
  <b>「$t->get_ok('/')」</b>という記述で実際に「/」にアクセスした場合の処理が実行されるからです。
</p>
<p>
  次にこのテストスクリプトををデバッガを使って起動しましょう。実行するディレクトリは、tディレクトリの中ではなくて、スクリプトのおいてあるディレクトリから行うのがよいでしょう。
</p>
<pre>
perl -d t/basic.t 
</pre>
<p>
  libディレクトリの中にモジュールを配置してある場合は次のようにlibディレクトリをモジュールの検索パスに追加してあげます。
</p>
<pre>
perl -d -Ilib t/basic.t 
</pre>
<h3> ブレークポイントで止まるには</h3>
<p>
  デバッガが起動したら「c」コマンドで「$DB::single = 1」と記述したブレークポイントまで進みます。
</p>
<pre>
c
</pre>
<p>
  デバッグをしたい位置に到着することができます。
</p>
<pre>
5
6:          $DB::single = 1;
7
8==&gt;        $self-&gt;render(text =&gt; 'Hello');
9:      };
10
11:     app-&gt;start;
</pre>
<p>
  このテクニックを覚えておけば、Mojolicious::Liteの開発はいっそう楽なものになります。
</p>

  </div>
  <div class="bottom">
    <!-- bottom -->

  </div>
</div>

        </div>
        <div class="side">
          <!-- side -->
<div class="side-list">
  <div class="side-list-title">
    目次
  </div>
  <ul>
    <li><a href="/list.html">記事一覧</a></li>
  </ul>
</div>

        </div>
      </div>
      <div class="footer">
        <!-- footer -->
<a href="http://www.perlzemi.com">Perlゼミ公式</a> & <a href="https://jp.giblog.net/">Giblog</a>

      </div>
    </div>
  </body>
</html>
