<!DOCTYPE html>
<html>
  <head>
    <!-- meta -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="stylesheet" type="text/css" href="/css/common.css">

<title>OpenSSHの導入 | Perl環境構築 - PerlゼミのLinux入門</title>
<meta name="description" content="(CentOS5.7で確認)">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <!-- header -->
<h1>
  <a href="/">PerlゼミのLinux入門</a>
</h1>

      </div>
      <div class="main">
        <div class="content">
          <div class="entry">
  <div class="top">
    <!-- top -->

  </div>
  <div class="middle">
    <h2><a href="/blog/20190812175817.html">OpenSSHの導入 | Perl環境構築</a></h2>
<p>
  (CentOS5.7で確認)
</p>
<p>
  ##OpenSSHサーバの導入
</p>
<p>
  　SSHは安全なリモートログインを実現するサービスで、telnetのセキュリティ強化バージョンにあたります。SSHを利用すると通信に利用されるデータを暗号化することができます。SSHのためのサーバとして、OpenSSHというものがあります。
</p>
<p>
  　以下の３つのパッケージが必要になります。
</p>
<p>
  -openssh ( SSH接続のためのクライアントソフト )
</p>
<p>
  -openssh-server ( SSH接続を受け付けるサーバ )
</p>
<p>
  -openssl ( SSHの暗号化部分の実装であるSSLのためのソフトウェア )
</p>
<p>
  ##インストール
</p>
<p>
  　以下のコマンドでインストールできます。
</p>
<p>
  ```
</p>
<p>
  yum -y install openssh
</p>
<p>
  yum -y install openssh-server
</p>
<p>
  yum -y install openssl
</p>
<p>
  ```
</p>
<p>
  ##インストールの確認
</p>
<p>
  　rpmコマンドで上記３つのパッケージが含まれているかを確認します。
</p>
<p>
  ```
</p>
<p>
  rpm -q openssh
</p>
<p>
  rpm -q openssh-server
</p>
<p>
  rpm -q openssl
</p>
<p>
  ```
</p>
<p>
  ##サービス起動スクリプト
</p>
<p>
  　サービス起動スクリプトを見ればいろいろな情報がわかります。
</p>
<p>
  ```
</p>
<p>
  # サービス起動スクリプトを見る。
</p>
<p>
  view /etc/init.d/sshd
</p>
<p>
  ```
</p>
<p>
  ##サービスの自動起動の設定
</p>
<p>
  　自動起動の設定を確認する。
</p>
<p>
  ```
</p>
<p>
  # 自動起動の確認
</p>
<p>
  chkconfig --list sshd
</p>
<p>
  # ランレベル2345がonになっていない場合はonにする。(サービス起動スクリプトに推奨されるランレベルの記述がある。)
</p>
<p>
  chkconfig --level 2345 sshd on
</p>
<p>
  # サービスそのものとして登録されていない場合は追加する。
</p>
<p>
  chkconfig --add sshd
</p>
<p>
  ```
</p>
<p>
  ##サービスの開始・停止・確認
</p>
<p>
  ```
</p>
<p>
  # サービスが開始しているかどうかの確認
</p>
<p>
  service sshd status
</p>
<p>
  # 開始していない場合は開始
</p>
<p>
  service sshd start
</p>
<p>
  # 停止する場合は
</p>
<p>
  service sshd stop
</p>
<p>
  ```
</p>
<p>
  ##設定ファイル
</p>
<p>
  ###sshdの設定ファイル
</p>
<p>
  ```
</p>
<p>
  /etc/ssh/sshd_config
</p>
<p>
  ```
</p>
<p>
  ##設定ファイルでのセキュリティ上の考慮
</p>
<p>
  ###SSHのバージョンには2のみを使用する。
</p>
<p>
  　以下のようになっていることを確認。SSH1 にはセキュリティホールがあり、SSH2のみを使うようにする。
</p>
<p>
  ```
</p>
<p>
  Protocol 2
</p>
<p>
  ```
</p>
<p>
  ###rootでの直接的なログインを禁止する
</p>
<p>
  　rootで直接ログインできた場合、複数の管理者がいると、誰がrootで操作したのかが把握できなくなるのでrootログインを禁止します。
</p>
<p>
  ```
</p>
<p>
  PermitRootLogin no
</p>
<p>
  ```
</p>
<p>
  ###sshdのセキュリティに関するログ
</p>
<p>
  　デフォルトだと
</p>
<p>
  ```
</p>
<p>
  /var/log/secure
</p>
<p>
  ```
</p>
<p>
  に出力されるようです。
</p>
<p>
  ##アクセス制御設定ファイルの編集
</p>
<p>
  　特定のIPアドレスだけからのアクセスを許可するようにします。
</p>
<p>
  ###/etc/hosts.deny
</p>
<p>
  　まずsshdへのアクセスをすべて拒否する。
</p>
<p>
  ```
</p>
<p>
  sshd: ALL
</p>
<p>
  ```
</p>
<p>
  ###/etc/hosts.allow
</p>
<p>
  　必要なものだけアクセスを許可する(必要に応じて設定)。
</p>
<p>
  ```
</p>
<p>
  # (例)192.168.1.0 ～ 192.168.1.255 までを許可
</p>
<p>
  sshd: 192.168.1.
</p>
<p>
  ```
</p>
<p>
  ##公開鍵の作成
</p>
<p>
  　公開鍵はサーバ側ではなく、クライアント側で作成して、サーバ側に移動させます。クライアント側での鍵の作成も別途必要になります。
</p>
<p>
  ##ログインユーザのホームディレクトリに公開鍵を設置
</p>
<p>
  　クライアント側での公開鍵の作成作業が終われば、再びサーバ側での作業です。まず、自分のIDでサーバにログインします。
</p>
<p>
  　まず、.sshというディレクトリをユーザのホームディレクトリに作成します。( ~ はユーザのホームディレクトリを指します)
</p>
<p>
  ```
</p>
<p>
  mkdir ~/.ssh
</p>
<p>
  ```
</p>
<p>
  　確認するには
</p>
<p>
  ```
</p>
<p>
  ls -a
</p>
<p>
  ```
</p>
<p>
  とします。(.で始まるファイルは ls では見れないため )
</p>
<p>
  ここに、アップロードした公開鍵を移動しておきます。(公開鍵はホームディレクトリにアップロードしていると想定します。)
</p>
<p>
  ```
</p>
<p>
  mv ~/id_dsa.pub ~/.ssh
</p>
<p>
  ```
</p>
<p>
  　その後ログインユーザのホームディレクトリの .ssh/authorized_keys というファイルに、アップロードした公開鍵を追加書き込みします。
</p>
<p>
  ```
</p>
<p>
  # authorized_keysファイルの作成
</p>
<p>
  touch ~/.ssh/authorized_keys
</p>
<p>
  # authorized_keysファイルに追加書き込み
</p>
<p>
  cat ~/.ssh/id_dsa.pub >> ~/.ssh/authorized_keys
</p>
<p>
  # .sshディレクトリとauthorized_keysの書き込み権限はユーザだけにしておく
</p>
<p>
  # (こうしないとセキュリティ上の理由で接続できない)
</p>
<p>
  chmod 755 ~/.ssh
</p>
<p>
  chmod 644 ~/.ssh/authorized_keys
</p>
<p>
  #確認( 所有者はログインユーザで、パーミッションが上記のとおりになっていることを確認)
</p>
<p>
  # .sshディレクトリの確認( drwxr-xr-x )
</p>
<p>
  ls -al ~/
</p>
<p>
  # authorized_keysの確認( -rw-r--r-- )
</p>
<p>
  ls -al ~/.ssh/authorized_keys
</p>
<p>
  ```
</p>
<p>
  ##sshd_configの設定変更
</p>
<p>
  　設定ファイルは
</p>
<p>
  ```
</p>
<p>
  /etc/ssh/sshd_config
</p>
<p>
  ```
</p>
<p>
  です。
</p>
<p>
  　おそらく、以下の行がコメントアウトされているので # を消します。
</p>
<p>
  　公開鍵認証できるようにする設定と、公開鍵情報のファイルの設定です。
</p>
<p>
  ```
</p>
<p>
  #PubkeyAuthentication yes
</p>
<p>
  #AuthorizedKeysFile     .ssh/authorized_keys
</p>
<p>
  ```
</p>
<p>
  ↓
</p>
<p>
  ```
</p>
<p>
  PubkeyAuthentication yes
</p>
<p>
  AuthorizedKeysFile     .ssh/authorized_keys
</p>
<p>
  ```
</p>
<p>
  　公開鍵認証ができるようになったので、パスワード認証ができないようにしておきます。
</p>
<p>
  ```
</p>
<p>
  PasswordAuthentication yes
</p>
<p>
  ```
</p>
<p>
  ↓
</p>
<p>
  ```
</p>
<p>
  PasswordAuthentication no
</p>
<p>
  ```
</p>
<p>
  　設定を反映されるためsshdを再起動
</p>
<p>
  ```
</p>
<p>
  service sshd restart
</p>
<p>
  ```
</p>
<p>
  ##クライアント側からの接続
</p>
<p>
  　ここまでの作業を終えればクライアント側からSSH接続ができます。
</p>

  </div>
  <div class="bottom">
    <!-- bottom -->

  </div>
</div>

        </div>
        <div class="side">
          <!-- side -->
<div class="side-list">
  <div class="side-list-title">
    目次
  </div>
  <ul>
    <li><a href="/list.html">記事一覧</a></li>
  </ul>
</div>

        </div>
      </div>
      <div class="footer">
        <!-- footer -->
<a href="https://tutorial.perlzemi.com">Perlゼミ</a> & <a href="https://jp.giblog.net/">Giblog</a>

      </div>
    </div>
  </body>
</html>
